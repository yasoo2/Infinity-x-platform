# render.yaml - Render Configuration for Infinity-X Platform Backend

services:
  # Backend Service
  - type: web
    name: infinity-x-backend
    env: node
    rootDir: backend
    buildCommand: pnpm install && pnpm exec playwright install --with-deps
    startCommand: node server.mjs
    plan: starter
    autoDeploy: true
    envVars:
      - key: NODE_VERSION
      - key: PORT
        value: 10000
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: FRONTEND_URL
        value: https://admin.xelitesolutions.com

  # JOEngine AGI Service (The Brain)
  - type: web
    name: joengine-agi
    env: node
    rootDir: joengine-agi
    buildCommand: pnpm install
    startCommand: node index.mjs
    plan: starter
    autoDeploy: true
    envVars:
      - key: NODE_VERSION
      - key: PORT
        value: 3000 # Separate port for AGI
      - key: OPENAI_API_KEY
        sync: true # يشير إلى أن هذا المتغير يجب أن تتم مزامنته من إعدادات Render السرية
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false

  # Worker Service (The Factory)
  - type: worker
    name: joe-worker
    env: node
    rootDir: worker
    buildCommand: pnpm install && pnpm exec playwright install --with-deps
    startCommand: node worker.mjs
    plan: starter
    autoDeploy: true
    envVars:
      - key: NODE_VERSION
      - key: OPENAI_API_KEY
        sync: true # يشير إلى أن هذا المتغير يجب أن تتم مزامنته من إعدادات Render السرية
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
