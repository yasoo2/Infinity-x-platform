services:
  # Unified Service for Backend API and Frontend Serving
  - type: web
    name: infinity-x-platform
    env: node
    plan: free
    # Set the root directory to the project root, so we can access both backend and frontend
    rootDir: .
    # Build command now orchestrates both frontend and backend setup
    buildCommand: |
      echo "Building frontend..."
      cd dashboard-x && npm install && npm run build && cd ..
      echo "Installing backend dependencies..."
      cd backend && npm install
    # Start command remains the same, running the unified server
    startCommand: "node backend/server.mjs"
    envVars:
      - key: NODE_VERSION
        value: 22
      - key: DATABASE_URL
        fromDatabase:
          name: infinity-x-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: SUPER_ADMIN_EMAIL
        sync: false
      - key: SUPER_ADMIN_PASSWORD
        sync: false

  # Database for the application
  - type: mongodb
    name: infinity-x-db
    plan: free
