/**\n * üè≠ Project Factory Tool - Now as a Dynamic Function\n * @version 2.0.0\n * This tool queues a new AI-driven project generation task by adding it to a MongoDB collection,\n * where a background worker will process it. It\'s designed for dynamic discovery by the ToolManager.\n */\nimport { MongoClient, ObjectId } from \'mongodb\';\n\n// --- Database Configuration ---\nconst MONGO_URI = process.env.MONGO_URI;\nconst DB_NAME = process.env.DB_NAME || \'joe_db\';\nconst JOBS_COLLECTION = \'jobs\';\n\n// --- The Tool Function ---\n\nasync function generateProject({ description, projectType = \'auto-detect\', title, options = {} }) {\n    if (!MONGO_URI) {\n        console.error(\"[ProjectFactory] MONGO_URI is not set. Cannot queue jobs.\");\n        return { success: false, error: \"DATABASE_NOT_CONFIGURED\", message: \"The project factory database is not connected.\" };\n    }\n\n    let mongoClient;\n    try {\n        mongoClient = await MongoClient.connect(MONGO_URI);\n        const db = mongoClient.db(DB_NAME);\n\n        const job = {\n            _id: new ObjectId(),\n            status: \'QUEUED\',\n            type: projectType,\n            title: title || \"Untitled AI Project\",\n            description,\n            command: description, // The worker uses this as a fallback\n            ...options, // Pass through any extra options from the LLM\n            priority: options.priority || 1,\n            attempts: 0,\n            createdAt: new Date(),\n        };\n\n        const result = await db.collection(JOBS_COLLECTION).insertOne(job);\n        const jobId = result.insertedId.toString();\n\n        return {\n            success: true,\n            message: `Your project \\\"${title}\\\" has been successfully queued. An AI worker will begin generating it shortly.`,\n            jobId: jobId,\n            status: \'QUEUED\',\n        };\n\n    } catch (error) {\n        console.error(`[ProjectFactory] Error queuing job:`, error);\n        return {\n            success: false,\n            error: \"JOB_QUEUE_FAILED\",\n            message: `Failed to queue the project generation job: ${error.message}`\n        };\n    } finally {\n        if (mongoClient) {\n            await mongoClient.close();\n        }\n    }\n}\n\n// --- Metadata for Dynamic Discovery ---\n\ngenerateProject.metadata = {\n    name: \"generateProject\",\n    description: \"Queues a task for an AI worker to generate a complete software project based on a detailed description. Use this for creating new websites, web apps, or backend services.\",\n    parameters: {\n        type: \"object\",\n        properties: {\n            title: {\n                type: \"string\",\n                description: \"The official title of the project (e.g., \'My Personal Portfolio\', \'SaaS Boilerplate API\').\"\n            },\n            description: {\n                type: \"string\",\n                description: \"A detailed, multi-sentence description of the project. Should include the purpose, main features, and any specific technologies or design styles desired.\"\n            },\n            projectType: {\n                type: \"string\",\n                description: \"The specific type of project to generate.\",\n                enum: [\"website\", \"webapp\", \"ecommerce\", \"cli-tool\", \"discord-bot\", \"auto-detect\"]\n            },\n            options: {\n                type: \"object\",\n                description: \"Optional advanced parameters. For example, specify deployment targets like { deployToVercel: true } or add specific features for a webapp like { features: [\'authentication\', \'database\'] }.\"\n            }\n        },\n        required: [\"title\", \"description\"]\n    }\n};\n\n// --- Exporting the tool in the expected format ---\n\nexport default { generateProject };\n