/**\n * Reasoning Engine for JOEngine AGI\n * Analyzes user requests and generates a structured, step-by-step plan for the Execution Engine.\n */\n\nimport { OpenAI } from \'openai\';\n\nexport class ReasoningEngine {\n    constructor(config) {\n        this.config = config;\n        this.openai = new OpenAI({ apiKey: config.openaiApiKey });\n        this.model = \'gpt-4o\'; // Use a powerful model for reasoning\n        this.availableTools = config.availableTools || []; // Should be loaded from a tool manager\n    }\n\n    /**\n     * Analyzes a user request and generates a step-by-step execution plan.\n     * @param {string} userRequest The user\'s high-level goal.\n     * @returns {Promise<object>} A structured plan with subtasks.\n     */\n    async createPlan(userRequest) {\n        console.log(`\nğŸ¤” Generating execution plan for: \\"${userRequest}\\"...`);\n\n        const systemPrompt = `\nØ£Ù†Øª **Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø¨Ø± (Mastermind)** ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ **JOE**.\n\n**Ù…Ù‡Ù…ØªÙƒ:** ØªØ­Ù„ÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¹Ù‚Ø¯ ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ Ø®Ø·Ø© Ø¹Ù…Ù„ **Ù…ÙØµÙ„Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°**.\n\n**Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:**\n${this.availableTools.map(tool => `- **${tool.name}**: ${tool.description}`).join(\'\\n\')}\n\n**Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø©:**\n1.  **Ø§Ù„Ø®Ø·Ø© ÙÙ‚Ø·:** ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ø¯Ùƒ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† ÙƒØ§Ø¦Ù† JSON **ÙÙ‚Ø·**ØŒ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ markdown.\n2.  **Ù„Ø§ Ù„Ù„ØªÙ†ÙÙŠØ°:** Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø§Ù„ØªØ®Ø·ÙŠØ· ÙÙ‚Ø·ØŒ Ù„Ø§ ØªÙ‚Ù… Ø¨ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ùˆ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙŠ Ø¯Ø§Ù„Ø©.\n3.  **Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©:** ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø¯ÙˆØ§Ù„ ÙˆØ§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…ØªØ·Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ù‹Ø§ Ù…Ø¹ Ù…Ø§ Ù‡Ùˆ Ù…ØªØ§Ø­.\n4.  **Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©:** Ù‚Ø³Ù‘Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø³Ù„Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©.\n5.  **Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ‚:** Ù„ÙƒÙ„ Ø®Ø·ÙˆØ©ØŒ Ø§Ø´Ø±Ø­ Ù„Ù…Ø§Ø°Ø§ Ø§ØªØ®Ø°Øª Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø±Ø§Ø± ÙÙŠ Ø­Ù‚Ù„ \\"thought\\".\n\n**ØµÙŠØºØ© Ø§Ù„Ø±Ø¯ (JSON ÙÙ‚Ø·):**\n\\\`\\\`\\\`json\n{\n  \\"thought\\": \\"Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù†Ù†ÙŠ Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ 3 Ø®Ø·ÙˆØ§Øª Ø±Ø¦ÙŠØ³ÙŠØ©...\\",\n  \\"plan\\": {\n    \\"description\\": \\"Ø®Ø·Ø© Ø¹Ù…Ù„ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${userRequest}\\",\n    \\"subtasks\\": [\n      {\n        \\"thought\\": \\"Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨...\\",\n        \\"description\\": \\"Ù‚Ø±Ø§Ø¡Ø© Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù package.json\\",\n        \\"tool\\": \\"FileSystemTool\\",\n        \\"function\\": \\"readFile\\",\n        \\"args\\": {\n          \\"path\\": \\"package.json\\"\n        }\n      },\n      {\n        \\"thought\\": \\"Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù‡ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±...\\",\n        \\"description\\": \\"ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ù\\",\n        \\"tool\\": \\"CodeTool\\",\n        \\"function\\": \\"refactorCode\\",\n        \\"args\\": {\n          \\"originalCode\\": \\"<file_content>\\", // Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§\n          \\"command\\": \\"Ù‚Ù… Ø¨Ø²ÙŠØ§Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ (minor version)\\"\n        }\n      }\n    ]\n  }\n}\n\\\`\\\`\\\`\n`;\n\n        try {\n            const response = await this.openai.chat.completions.create({\n                model: this.model,\n                messages: [\n                    { role: \'system\', content: systemPrompt },\n                    { role: \'user\', content: `URGENT: Create a plan for this request: \\"${userRequest}\\"` }\n                ],\n                response_format: { type: \'json_object\' },\n                temperature: 0.1, // Low temperature for deterministic planning\n            });\n\n            const planJson = response.choices[0].message.content;\n            const plan = JSON.parse(planJson);\n\n            console.log(\'âœ… Execution plan generated successfully.\');\n            return { success: true, plan: plan.plan };\n\n        } catch (error) {\n            console.error(`âŒ Error in Reasoning Engine while creating plan: ${error.message}`);\n            return {\n                success: false,\n                error: `Failed to create a plan: ${error.message}`\n            };\n        }\n    }\n}\n\nexport default ReasoningEngine;\n