#!/bin/sh

echo "[husky] Running quality checks (lint/tests) before sync..."
npm run lint || npm run lint:fix || true
npm test || true

branch="$(git rev-parse --abbrev-ref HEAD)"
remote="origin"

if [ -n "$branch" ]; then
  git fetch "$remote" "$branch" || true
  git pull --rebase --autostash "$remote" "$branch" || { git rebase --abort || true; git pull --rebase -X ours "$remote" "$branch" || true; }
  git push "$remote" "$branch" || git push --force-with-lease "$remote" "$branch"
fi
